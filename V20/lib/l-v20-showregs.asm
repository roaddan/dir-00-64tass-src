;***************************************; Affiche en hexadÃ©cimal le contenu des ; registres A, X, Y, P, S et PC; dans une fenetre pop-up.;***************************************showregs  .block    ;-----------------------------------     ; Sauvegarde le contenu ecran.    ;-----------------------------------           jsr scrnsave          php    ;-----------------------------------     ; stack-> sr, pcl, pch    ;-----------------------------------           sta  ar          pla       ;acc<-sr    ;-----------------------------------     ; stack-> pcl, pch    ;-----------------------------------           sta  sr          stx  xr          sty  yr          tsx       ; x<-sp                stx  sp    ;-----------------------------------     ; stack-> pcl, pch    ; Copie PC dans les variables.    ;-----------------------------------           pla          sta  thispcl                   pla                           sta  thispch          pha          lda  thispcl          pha             ;-----------------------------------     ; stack-> pcl, pch    ;-----------------------------------           lda #$00          ldx #regline   ; No. de ligne          tay          clc          jsr plot       ; pos. curseur.          #outcar snoir  ; texte en noir          ; Affiche ligne titre          #prnligne 176,174,rtitle          ; Affiche ligne etiquettes          #prnligne 221,221,rlable          ; Affiche ligne valeurs          #prnligne 221,221,rvalues          ; Affiche ligne du bas          #prnligne 173,189,rbline     ;-----------------------------------      ; Affiche adresse de retour          ;-----------------------------------           ldy  thispch          ldx  thispcl                      inx       ; Aj. LSB adresse           bcc  go   ; Report? Non Go!          iny       ; Oui, Aj. MSB          ; On positionne et on affichego        #locate 1,regline+2          jsr putyxhex   ; pc     ;-----------------------------------     ; Affiche le registre Acc.     ;-----------------------------------           lda  ar          ; On positionne et on affiche          #locate 6,regline+2          jsr putahex    ; reg x     ;-----------------------------------      ; Affiche le registre X.     ;-----------------------------------           lda  xr          ; On positionne et on affiche          #locate 9,regline+2          jsr  putahex    ; reg x     ;-----------------------------------      ; Affiche le registre Y.     ;-----------------------------------           lda  yr          ; On positionne et on affiche          #locate 12,regline+2          jsr  putahex    ; reg y     ;-----------------------------------      ; Affiche le registre de status.     ;-----------------------------------           lda  sr          ; On positionne et on affiche          #locate 15,regline+2          jsr putahex    ; status reg     ;-----------------------------------      ; Affiche le LSB du ptr de pile.     ;-----------------------------------           lda  sp          txa          ; On positionne et on affiche          #locate 18,regline+2          jsr putahex    ; sp     ;-----------------------------------      ; Attend la clef [CTRL][X]     ;-----------------------------------           jsr  clrkbbuf          jsr  anykey;waitkey   jsr  getkey;          cmp  #$18  ; [CTRL][X];          bne  waitkey    ;-----------------------------------     ; Recipere le contenu ecran.    ;-----------------------------------           jsr scrnrest          lda  ar          ldx  xr          ldy  yr          lda  sr          pha          plp          rts;-------------------------------------- regline   = 9ar        .byte     0xr        .byte     0yr        .byte     0sr        .byte     0sp        .byte     0thispcl       .byte     0thispch       .byte     0          .bend;**************************************;;**************************************showstack .block          sta ra          php          pla          sta sr          stx rx          sty ry          sec          ldy  #$10          tsx          inx          txa          jsr showra          #outcar 13          #outcar 13          morey     lda $0100,x          jsr showra          #outcar 13          inx          dey          bne morey          lda sr          pha          lda ra          ldx rx          ldy ry          plp          rtssr        .byte 0ra        .byte 0rx        .byte 0ry        .byte 0          .bend;**************************************prnligne  .macro lcar, rcar, pointeur          jsr  pushregs          lda #\lcar          sta \pointeur+0          lda #\rcar          sta \pointeur+24          ldx  #<\pointeur          ldy  #>\pointeur          jsr  putsyx          jsr  popregs          .endm