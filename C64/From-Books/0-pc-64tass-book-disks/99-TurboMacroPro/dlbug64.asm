;---------------------------------------; nom fichier..: prog.asm; type fichier.: source pour t.m.p.; auteur.......: daniel lafrance; version......: 20151125; revision.....: 0.0.2;---------------------------------------        .include "m-utils.asm"        .include "e-vars.asm"        .include "e-float.asm"        .include "e-64map.asm"        .include "l-bashead.asm"        .include "l-screen.asm";---------------------------------------main        .block        #outcar 14 ;Force maj/minuscule        #outcar 8  ;Bloque Carset chang.        ldy #$00        ldx #$00        jsr ramprobe        rts        .bend;---------------------------------------ramprobe        .block        jsr pushregs        jsr clrkbbuf        #styxptr dumpadr        #outcar 147        jsr showmenu        jmp doitava128  clc        lda dumpadr        adc #$80        bcc nrep128        inc dumpadr+1   nrep128 sta dumpadr        jmp doitarr128  sec        lda dumpadr        sbc #$80        bcs nemp128        dec dumpadr+1   nemp128 sta dumpadr        jmp doitava256  inc dumpadr+1           jmp doitarr256  dec dumpadr+1           jmp doitava512  inc dumpadr+1        jmp doitarr512  dec dumpadr+1        jmp doitarr1k   lda dumpadr+1        sec        sbc #$10        sta dumpadr+1        jmp doitava1k   lda dumpadr+1        clc        adc #$10        sta dumpadr+1        jmp doitdoit    #locate 1,1        lda #16        #ldyxptr dumpadr        jsr memdumpmorekey jsr getkey        jsr showkeychkf1   cmp #133   ; touche [F1]        bne chkf2        jsr aide         jmp morekey; +128     chkf2   cmp #137   ; touche [F2]        bne chkf3         jmp morekey;-128chkf3   cmp #134   ; touche [F3]        bne chkf4        jmp ava128 ;+128chkf4   cmp #138   ; touche [F4]        bne chkf5        jmp arr128 ;-128chkf5   cmp #135   ; touche [F6]        bne chkf6        jmp ava512  ;+512 chkf6   cmp #139   ; touche [F6]        bne chkf7        jmp arr512 ;-512chkf7   cmp #136   ; touche [F7]        bne chkf8        jmp ava1k  ;+1024chkf8   cmp #140   ; touche [F8]        bne chk20        jmp arr1k  ;-1024chk20   cmp #$20   ; touche espace        bne chkn        jmp doit    chkn    cmp #78    ; touche n        bne chkq        jsr getadr ; demande adresse        jsr morekeychkq    cmp #$51   ; touche q        beq quitter        jmp morekeyquitter jsr popregs        #outcar 147        #locate 0,0        rts        .bend getadr  .block        jsr pushall        jsr scrnsave        ldy #>abox        ldx #<abox        jsr drawboxgetit   jsr getkey        cmp #81        beq out        ora #$20        cmp #$30        ;<0        bmi getit        cmp #$39        ;>F        bmi getit                cmp #$62        bmi getit               cmp #$3a        ;>9        bpl getit        jsr showkey        jmp getitout     jsr scrnrest        ;jsr getkey        jsr popall        rts        .bendshowkey .block        jsr pushregs        #locate 39-11,24        jsr chrout        #outcar 32        #outcar 36        jsr putahexdec        jsr popregs        rts        .bend;--------------------------------------- ; Affiche le contenue memoire a la ; maniere de supermon par ligne 8; octets.; $yyxx contiennent l'adresse de depart;  $FFFF pour continuer la ou il etait.; acc. contien le nombre de ligne a ; afficher.      memdump         .block        jsr pushregs        sta nligne ;sauve ligne        sta loops  ;init boucle        #styxptr dumpadr        lda dumpadr+1        pha        lda dumpadr        phaagain   #ldyxptr dumpadr        lda #$08        #outcar $0d        jsr bytestohex        jsr yxtoptr        jsr incptr8        jsr ptrtoyx        #styxptr dumpadr               dec loops        bne again        pla        sta dumpadr        pla        sta dumpadr+1        jsr popregs        rtsnligne  .byte $16        .benddumpadr .word $f000;---------------------------------------putahexdec        .block        jsr pushregs        #outcar kjaune        jsr putahex        #outcar $20        #outcar kcyan        tax        lda #$00        jsr fiaxtf1        jsr popregs        rts        .bend;---------------------------------------; entree: x=colonne y=ligne (bmp)calcdot        .block        jsr pushall        tya     ;y contien la ligne        lsr a   ; on divise par 8        lsr a        lsr a        sta row ; et on sauvegarde        txa     ;x contien la colonne        lsr a   ; on divise par 8        lsr a        lsr a        sta col ; et on sauvegarde        tya     ; masque avec 7 donne        and #$07; la ligne caractere        sta lin ; du pixel.        txa     ;7-(x and 7) donne le        and #$07; no du bit de l'octet        sta sbit; du pixel.        lda #$07        sec        sbc sbit        sta sbit        ;------------------------------        ; inserer calcul adresse ici        ;------------------------------        ;ldx #$00        ;lda #$02        ;jsr fiaxtf1        ;#outcar $0d                 jsr popall        rts        .bend;---------------------------------------floattest;---------------------------------------        .block        php        pha        lda #$07        sta kcol        ;jsr getfac1        ldy sbit        jsr fiyytf1        jsr prnfac1        ;lda #$03        ;sta kcol        ;jsr prnfac1        ;lda #$01        ;sta kcol        pla        plp        rts        .bendshowmenu        .block        #locate 1,0        #outstr dmphead         #locate 1,1        #outstr dmphead2         #locate 1,20        #outstrxy menu0        #outstrxy menu1        #outstrxy menu2        #outstrxy menu3        #outstrxy menu4        #outstrxy menu5        #outstrxy menu6        rts        .bend;---------------------------------------aide    .block        jsr pushall        jsr scrnsave        ldy #>hbox        ldx #<hbox        jsr drawbox        jsr getkey        jsr scrnrest        jsr popall        rts        .bend;---------------------------------------        .include "l-push.asm"        .include "l-mem.asm"        .include "l-conv.asm"        .include "l-string.asm"        .include "l-float.asm"        .include "l-keyb.asm"        .include "l-math.asm"        .include "l-bitmap.asm"        .include "l-drawbox.asm"        .include "string-fr.asm" ;---------------------------------------