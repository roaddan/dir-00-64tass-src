;---------------------------------------; nom fichier..: prog.asm; type fichier.: source pour t.m.p.; auteur.......: daniel lafrance; version......: 20151125; revision.....: 0.0.2;---------------------------------------        .include "m-utils.asm"        .include "e-vars.asm"        .include "e-float.asm"        .include "e-64map.asm"        .include "l-bashead.asm"        .include "l-screen.asm";---------------------------------------main        .block        #outcar 14 ;Force maj/minuscule        #outcar 8  ;Bloque Carset chang.        ldy #$00        ldx #$00        jsr ramprobe        rts        .bend;---------------------------------------ramprobe        .block        jsr pushregs        jsr clrkbbuf        #styxptr dumpadr        #outcar 147        jsr showmenu        jmp doitava128  clc        lda dumpadr        adc #$80        bcc nrep128        inc dumpadr+1   nrep128 sta dumpadr        jmp doitarr128  sec        lda dumpadr        sbc #$80        bcs nemp128        dec dumpadr+1   nemp128 sta dumpadr        jmp doitava256  inc dumpadr+1           jmp doitarr256  dec dumpadr+1           jmp doitava512  inc dumpadr+1        jmp doitarr512  dec dumpadr+1        jmp doitarr1k   lda dumpadr+1        sec        sbc #$10        sta dumpadr+1        jmp doitava1k   lda dumpadr+1        clc        adc #$10        sta dumpadr+1        jmp doitdoit    #locate 1,1        lda #16        #ldyxptr dumpadr        jsr memdumpmorekey jsr getkey        ;jsr showkeychkf1   cmp #133   ; touche [F1]        bne chkf2        jsr aide         jmp morekey; +128     chkf2   cmp #137   ; touche [F2]        bne chkf3         jmp morekey;-128chkf3   cmp #134   ; touche [F3]        bne chkf4        jmp ava128 ;+128chkf4   cmp #138   ; touche [F4]        bne chkf5        jmp arr128 ;-128chkf5   cmp #135   ; touche [F6]        bne chkf6        jmp ava512  ;+512 chkf6   cmp #139   ; touche [F6]        bne chkf7        jmp arr512 ;-512chkf7   cmp #136   ; touche [F7]        bne chkf8        jmp ava1k  ;+1024chkf8   cmp #140   ; touche [F8]        bne chk20        jmp arr1k  ;-1024chk20   cmp #$20   ; touche espace        bne chkn        jmp doit    chkn    cmp #78    ; touche n        bne chkq        jsr getadr ; demande adresse        jsr morekeychkq    cmp #$51   ; touche q        beq quitter        jmp morekeyquitter jsr popregs        #outcar 147        #locate 0,0        rts        .bend ;---------------------------------------getadr  .block        jsr pushall        jsr scrnsave        ldy #>boxa        ldx #<boxa        jsr drawbox        lda #boxac        #printboxt boxat1        #printboxt boxat2        ldy #$05        lda #$00        sta hexptrmore0   sta hexadr,y        dey        bpl more0        lda #$04        sta counterhexread jsr getkey        ;jsr showkey        cmp #$0d        beq convert        cmp #$14        ; touche bkspc        beq bkspc        cmp #$5f        ; touche esc        beq cancel        cmp #$30        ;<0        bcc hexread     ; less than        cmp #$a7        ;>F        bcs hexread     ; greater than           cmp #$3a        ;>9        bcc ok        cmp #$41        ;        bcc hexreadok      jsr chrout        ldy hexptr        sta hexadr,y        inc hexptr        dec counter        beq convert        jmp hexreadbkspc   lda hexptr        beq nothing        #outcar 157        #outcar 32        #outcar 157        inc counter        dec hexptr        ldy hexptr        lda #$00        sta hexadr,ynothing jmp hexreadconvert cancelout     jsr scrnrest        #ldyximm hexpos        jsr putsxy        jsr getkey        jsr scrnrest        jsr popall        rtshexpos .byte 3,24        hexadr .byte 0,0,0,0,0hexptr .byte $00counter .byte $00         .bend;---------------------------------------showkey .block        jsr pushregs        sec        jsr plot        stx curx        sty cury        #locate 39-11,24        jsr chrout        #outcar 32        #outcar 36        jsr putahexdec        clc        ldy cury        ldx curx        jsr plot        jsr popregs        rtscurx    .byte 0cury    .byte 0        .bend;--------------------------------------- ; Affiche le contenue memoire a la ; maniere de supermon par ligne 8; octets.; $yyxx contiennent l'adresse de depart;  $FFFF pour continuer la ou il etait.; acc. contien le nombre de ligne a ; afficher.      memdump         .block        jsr pushregs        sta nligne ;sauve ligne        sta loops  ;init boucle        #styxptr dumpadr        lda dumpadr+1        pha        lda dumpadr        phaagain   #ldyxptr dumpadr        lda #$08        #outcar $0d        jsr bytestohex        jsr yxtoptr        jsr incptr8        jsr ptrtoyx        #styxptr dumpadr               dec loops        bne again        pla        sta dumpadr        pla        sta dumpadr+1        jsr popregs        rtsnligne  .byte $16        .benddumpadr .word $f000;---------------------------------------putahexdec        .block        jsr pushregs        #outcar kjaune        jsr putahex        #outcar $20        #outcar kcyan        tax        lda #$00        jsr fiaxtf1        jsr popregs        rts        .bend;---------------------------------------showmenu        .block        #locate 1,0        #outstr dmphead         #locate 1,1        #outstr dmphead2         #locate 1,20        #outstrxy menu0        #outstrxy menu1        #outstrxy menu2        #outstrxy menu3        #outstrxy menu4        #outstrxy menu5        #outstrxy menu6        rts        .bend;---------------------------------------aide    .block        jsr pushall        jsr scrnsave        ldy #>boxh        ldx #<boxh        jsr drawbox        jsr getkey        jsr scrnrest        jsr popall        rts        .bend;---------------------------------------        .include "l-push.asm"        .include "l-mem.asm"        .include "l-conv.asm"        .include "l-string.asm"        .include "l-float.asm"        .include "l-keyb.asm"        .include "l-math.asm"        .include "l-bitmap.asm"        .include "l-drawbox.asm"        .include "string-fr.asm" ;---------------------------------------