
; 64tass Turbo Assembler Macro V1.54.1900 listing file
; 64tass -C -m -a -T -I /Users/Locals/C64/00-usbkey32go/d-00-64tass-src/lib -i -l e-rom9000.asm -L rom9000.txt -o rom9000.prg rom9000.asm
; Tue Dec 30 12:33:21 2025

;Offset	;Hex		;Source

;******  Processing input file: rom9000.asm

>9000	4c 49 42 43	     .null "libc64"
>9004	36 34 00

;******  Processing file: e-64map.asm

=$00			eot      = $00
=$73			chrget   = $73   ;Recup Basic car texte
=$79			chrgot   = $79   ; ...une seconde fois.
=$c1			stal     = $c1
=$d1			scrnlin  = $d1   ;acresse ligne courante
=$fb			zp1      = $fb   ;1er Zpage prog. usager
=$fd			zp2      = $fd   ;2em Zpage prog. usager
=$0100			fascii   = $0100 ;region conv FP a ascii
=$0286			kcol     = $0286 ;Couleur car affiche.
=$fce2			reboot   = $fce2 ;Redemarrage a froid
=$fe66			reset    = $fe66 ;Redemarrare a chaud
=$e3bf			intcgt   = $e3bf ;Initialize chrget
=$ffa5			acptr    = $ffa5 ;Recoit byte port serie
=$ffc6			chkin    = $ffc6 ;Definie canal entree
=$ffc9			chkout   = $ffc9 ;Definie canal sortie
=$ffcf			chrin    = $ffcf ;Entre car canal entree
=$ffd2			chrout   = $ffd2 ;Sort car canal sortie
=$ff81			cint     = $ff81 ;Init ecran edit+vicii
=$ffa8			ciout    = $ffa8 ;Sort car sur bus serie
=$ffe7			clall    = $ffe7 ;Ferme tout fichier ouv
=$ffc3			close    = $ffc3 ;Ferme fichier logique
=$ffcc			clrchn   = $ffcc ;Efface caneaux i/o
=$ffe4			getin    = $ffe4 ;Entre un car de entree
=$fff3			iobase   = $fff3 ;Definie page mem. i/o
=$ff84			ioinit   = $ff84 ;Init. Periph. i/o
=$ffb1			listen   = $ffb1 ;Cmd LISTEN a perip bus
=$ffd5			load     = $ffd5 ;Charge periph. en ram
=$ff9c			membot   = $ff9c ;Lec./Ecr. bas mem.
=$ff99			memtop   = $ff99 ;Lec./Ecr. haut mem.
=$ffc0			open     = $ffc0 ;Ouvre fichier logique.
=$fff0			plot     = $fff0 ;Lec./Ecr. pos. curseur
=$ff87			ramtas   = $ff87 ;Init ram tapebuf+ecran
=$ffde			rdtim    = $ffde ;Recup horloge systeme
=$ffb7			readst   = $ffb7 ;Recup mot status i/o
=$ff8a			restor   = $ff8a ;Replace vecteurs i/o
=$ffd8			save     = $ffd8 ;Sauve mem vers periph
=$ff9f			scnkey   = $ff9f ;Sonde le clavier
=$ffed			screen   = $ffed ;Recup format ecran
=$ff93			second   = $ff93 ;Trans adr secnd/listen
=$ffba			setlfs   = $ffba ;Prep. fichier logique
=$ff90			setmsg   = $ff90 ;Prep. kmesg outpt flag
=$ffbd			setnam   = $ffbd ;Prep. nom de fichier
=$ffdb			settim   = $ffdb ;Init. horloge systeme
=$ffa2			settmo   = $ffa2 ;Place ieee delai fin
=$ffe1			stop     = $ffe1 ;Verif. clef stop
=$ffb4			talk     = $ffb4 ;Cmd LISTEN periph/SB
=$ff96			tsks     = $ff96 ;Trans. TALK secnd adr
=$ffea			udtim    = $ffea ;Maj. horloge systeme
=$ffae			unlsn    = $ffae ;Trans. UNLISTEN
=$ffab			untlk    = $ffab ;Trans. UNTALK
=$ffd8			vector   = $ffd8 ;Lec/ecr vecteurs i/o
=$d000			vic      = $d000 ;debut du vic-ii
=$0340			sprtmem  = $0340 ;832
=$07f8			sprtloc  = $07f8 ;2040
=$2000			vidstart = $2000
=$3f3f			vidend   = $3f3f
=$0400			bakmem   = $0400 ;1024 end at $0800
=$abf9			prompt   = $abf9 ;prompt ? dans tampon.
=$ab24			strout   = $ab24 ;print string at $0022
=8			discase = 8
=9			enacase = 9
=14			locase  = 14
=142			upcase  = 142
=17			crsdown = 17
=29			crsright= 29
=145			crsup   = 145
=157			crsleft = 157
=18			enarevs = 18
=146			disrevs = 146
=19			gohome  = 19
=147			clrhome = 147
=20			delete  = 20
=32			space   = 32
=0			snoir   = 0
=144			knoir   = 144
=1			sblanc  = 1
=5			kblanc  = 5
=2			srouge  = 2
=28			krouge  = 28
=3			scyan   = 3
=159			kcyan   = 159
=4			smauve  = 4
=156			kmauve  = 156
=5			svert   = 5
=30			kvert   = 30
=6			sbleu   = 6
=31			kbleu   = 31
=7			sjaune  = 7
=158			kjaune  = 158
=8			sorange = 8
=129			korange = 129
=9			sbrun   = 9
=149			kbrun   = 149
=10			srose   = 10
=150			krose   = 150
=11			sgris1  = 11
=151			kgris1  = 151
=12			sgris2  = 12
=152			kgris2  = 152
=13			svertp  = 13
=153			kvertp  = 153
=14			sbleup  = 14
=154			kbleup  = 154
=15			sgris3  = 15
=155			kgris3  = 155
=176			tleft    = 176 ; Coin suppérieur gauche.
=174			tright   = 174 ; Coin suppérieur droit.
=173			bleft    = 173 ; Coin inférieur gauche.
=189			bright   = 189 ; Coin inférieur droit.
=171			hleft    = 171 ; Extr. gauche médianne.
=179			hright   = 179 ; Extr. droite médianne.
=221			vline    = 221 ; Ligne verticale.
=192			hline    = 192 ; Ligne horizontale.

;******  Return to file: rom9000.asm


;******  Processing file: e-float.asm

=$ba8c			ffvtf2   = $ba8c ;copie 4 byt $(yyaa) f2
=$bba2			ffvtf1   = $bba2 ;copie fp $(yyaa) to f1
=$bbc7			ff1t5c   = $bbc7 ;copie f1 to $5c-$60
=$bbca			ff1t57   = $bbca ;copie f1 to $57-$5b
=$bbd0			ff1t49   = $bbd0 ;copie f1 to $49.
=$bbd4			ff1tyx   = $bbd4 ;copie f1 mem $yyxx.
=$bbfc			ff2tf1   = $bbfc ;copie f2 to f1
=$bc0c			ff1tf2   = $bc0c ;copie f1 to f2
=$b849			ff1p05   = $b849 ;f1=f1+0.5
=$b850			ffvsf1   = $b850 ;f1=fv-f1 ($yyaa)
=$b853			ff2sf1   = $b853 ;f1=f2-f1
=$b867			ffvpf1   = $b867 ;f1=fv+f1 ($yyaa)
=$b86a			ff2pf1   = $b86a ;f1=f2+f1
=$bd7e			ff1pac   = $bd7e ;f1=f1+ra val ra=0-9
=$ba28			ff1xfv   = $ba28 ;f1=f1*fv ($yyaa)
=$ba2b			ff1xf2   = $ba2b ;f1=f1*f2
=$bae2			ff1x10   = $bae2 ;f1=f1*10
=$bafe			ff1d10   = $bafe ;f1=f1/10
=$bb0f			ffvdf1   = $bb0f ;f1=fv/f1 ($yyaa)
=$bb12			ff2df1   = $bb12 ;f1=f2/f1
=$afe6			ffpor    = $afe6 ;f1=f1 or f2
=$afe9			ffpand   = $afe9 ;f1=f1 and f2
=$b947			ff1com2  = $b947 ;f1=two's compl f1
=$bc1b			ff1rnd   = $bc1b ;f1=round(f1)
=$bc39			ff1sign  = $bc39 ;f1=sgn(f1)
=$bc58			ff1abs   = $bc58 ;f1=abs(f1)
=$bc5b			ffvcmp   = $bc5b ;f1=f1 comp fv ($yyaa)
=$bccc			ff1int   = $bccc ;f1=int(f1)
=$bf71			ff1sqr   = $bf71 ;f1=sqrt(f1)
=$bf7b			ff1ef2   = $bf7b ;f1=fac1^f2
=$b3a2			fiyytf1  = $b3a2 ;f1=float(y)
=$bc3c			fiaatf1  = $bc3c ;conv acc to fp in f1
=$bc44			fi62tf1  = $bc44 ;conv f1 word 62,63
=$bdcd			fiaxtf1  = $bdcd ;f1=float($aaxx)+print
=$bcf3			fasctf1  = $bcf3 ;f1=float(ascii)
=$bddd			ff1tasc  = $bddd ;f1 to ascii ($yyaa)
=$bc9b			ff1tudw  = $bc9b ;f1=unsighed dw(f1)
=$b1bf			ff1swd64 = $b1bf ;f1=sw(f1)->64
=$b1d2			ff1wrd64 = $b1d2 ;f1=uw(f1)->64
=$b1aa			ff1wrday = $b1aa ;f1=word->$aayy
=$b7a1			ff1bytxx = $b7a1 ;f1 to byte in x
=$b79e			ff1evalx = $b79e ;eval. expr. f1 to x
=$e264			ff1cos   = $e264 ;f1=sin(f1+(pi/2))
=$e26b			ff1sin   = $e26b ;f1=sin(f1)
=$e2b4			ff1tan   = $e2b4 ;f1=sin(f1)/cos(f1)
=$e30e			ff1atn   = $e30e ;f1=atn(f1)
=$bc2b			fsngf1   = $bc2b ;check f1 sign

;******  Return to file: rom9000.asm


;******  Processing file: e-vars.asm

=$d000			libre    = $d000
=53247			rp       = libre-$01;1 byte $cfff
=53246			ra       = rp-1     ;1 byte $cffe
=53245			rx       = ra-1     ;1 byte $cffd
=53244			ry       = rx-1     ;1 byte $cffc
=53243			rs       = ry-1     ;1 byte $cffb
=53241			pc       = rs-2     ;2 byte $cff9-$cffa
=53240			curcol   = pc-1     ;1 byte $cff6
=53239			memptr   = curcol-1;1 word $cff7-$cff8
=53239			hexv     = memptr
=53234			hexstr   = hexv-$05 ;5 byte $cff1-$cff5
=53233			a2hexpfx = hexv-$06 ;1 byte $cff0
=53232			a2hexpy  = hexv-$07 ;1 byte $cfef
=53231			a2hexpx  = hexv-$08 ;1 byte $cfee
=53231			a2hexpos = hexv-$08 ;0 byte $cfee
=53230			a2hexcol = hexv-$09 ;1 byte $cfed
=53230			binv     = a2hexcol
=53221			binstr   = binv-$09 ;9 byte $cfe4-$cfec
=53220			a2binpfx = binv-$0a ;1 byte $cfe3
=53219			a2binpy  = binv-$0b ;1 byte $cfe2
=53218			a2binpx  = binv-$0c ;1 byte $cfe1
=53218			a2binpos = binv-$0c ;0 byte $cfe1
=53217			a2bincol = binv-$0d ;1 byte $cfe0
=53217			decv     = a2bincol
=53211			decstr   = decv-$06 ;6 byte $cfda-$cfdf
=53210			a2decpfx = decv-$07 ;1 byte $cfd9
=53209			a2decpy  = decv-$08 ;1 byte $cfd8
=53208			a2decpx  = decv-$09 ;1 byte $cfd7
=53208			a2decpos = decv-$09 ;0 byte $cfd7
=53207			a2deccol = decv-$0a ;1 byte $cfd6
=53206			offset   = decv-$0b ;1 byte $c799
=53206			fltv     = offset
=53200			fvar1    = fltv-6  ; 6 byte $cfd0-$cfd5
=53194			fvar2    = fltv-12 ; 6 byte $cfca-$cfcf
=53174			float1   = fltv-32 ;20 byte $cfb6-$cfc9
=53154			float2   = fltv-52 ;20 byte $cfa2-$cfb5
=53153			tval1    = fltv-53 ; 1 byte $cfa1
=53151			tval2    = fltv-55 ; 2 byte $cf9f-$cfa0
=53149			reponse  = tval2-2      ; 2 byte $cf9d
=53149			edbox    = reponse
=53148			cleft    = edbox-1
=53147			cright   = edbox-2
=53146			cmid     = edbox-3
=53145			dbtop    = edbox-4
=53144			dbleft   = edbox-5
=53143			dbwdth   = edbox-6
=53142			dbhght   = edbox-7
=53141			dbcoul   = edbox-8
=53140			dbclin   = edbox-9
=53140			ekeyb    = dbclin
=53139			curx     = ekeyb-1
=53138			cury     = ekeyb-2
=53137			clef     = ekeyb-3
=53136			len      = clef-1
=53136			escr     =  len
=53135			loops    = escr-1       ; 1 byte $cf9c
=53133			loop16   = loops-2      ; 2 byte $cf9a
=52109			scrncar  = loop16-1024  ;1k byte $cb9a
=51085			scrncol  = scrncar-1024 ;1k byte $c79a
=51085			diskvar = scrncol
=51083			ddatas  = diskvar-2 ;2 byte Data start
=51081			ddatae  = diskvar-4 ;2 byte Data end
=51080			ddev    = diskvar-5 ;1 byte Dev number
=51079			dlfsno  = diskvar-6 ;1 byte Lfs
=51077			dfnptr  = diskvar-8 ;2 byte Ptrnfichier
=51076			dfnlen  = diskvar-9 ;1 byte lenfilename
=51075			genbyte1 = dfnlen-1    ; 1 byte $c799
=51073			genword1 = dfnlen-3    ; 2 byte $c799

;******  Return to file: rom9000.asm


;******  Processing file: l-bitmap.asm

.9007			bmapinit
.9007	08		         php
.9008	48		         pha
.9009	ad 18 d0	         lda vic+$18
.900c	09 08		         ora #$08
.900e	8d 18 d0	         sta vic+$18
.9011	ad 11 d0	         lda vic+$11
.9014	09 20		         ora #$20
.9016	8d 11 d0	         sta vic+$11
.9019	68		         pla
.901a	28		         plp
.901b	60		         rts
.901c			bmapclr
.901c	20 7a 94	         jsr pushall
.901f	a9 00		         lda #<vidstart
.9021	85 fb		         sta zp1
.9023	a9 20		         lda #>vidstart
.9025	85 fc		         sta zp1+1
.9027	a0 00		         ldy #$00
.9029	a9 00		more     lda #$00
.902b	91 fb		         sta (zp1),y
.902d	20 d6 93	         jsr inczp1
.9030	a5 fc		         lda zp1+1
.9032	c9 3f		         cmp #$3f
.9034	d0 f3		         bne more
.9036	a5 fb		         lda zp1
.9038	c9 3f		         cmp #$3f
.903a	d0 ed		         bne more
.903c	20 b3 94	         jsr popall
.903f	60		         rts
.9040			bmpfillbk
.9040	20 7a 94	         jsr pushall
.9043	a9 00		         lda #<bakmem
.9045	85 fb		         sta zp1
.9047	a9 04		         lda #>bakmem
.9049	85 fc		         sta zp1+1
.904b	a2 08		         ldx #$08
.904d	a0 00		         ldy #$00
.904f	a9 01		         lda #$01
.9051	91 fb		more     sta (zp1),y
.9053	20 d6 93	         jsr inczp1
.9056	e4 fc		         cpx zp1+1
.9058	d0 f7		         bne more
.905a	20 b3 94	         jsr popall
.905d	60		         rts

;******  Return to file: rom9000.asm


;******  Processing file: l-conv.asm

.905e			putyxhex
.905e	20 7a 94	        jsr pushall
.9061	98		        tya
.9062	48		        pha
.9063	20 ae 90	        jsr lsr4bits
.9066	20 b5 90	        jsr nibtohex
.9069	8d f2 cf	        sta hexstr+0
.906c	68		        pla
.906d	20 b5 90	        jsr nibtohex
.9070	8d f3 cf	        sta hexstr+1
.9073	8a		        txa
.9074	20 93 90	        jsr atohex
.9077	a2 f2		        ldx #<hexstr+0
.9079	a0 cf		        ldy #>hexstr+0
.907b	20 ca 95	        jsr putsyx
.907e	20 b3 94	        jsr popall
.9081	60		        rts
.9082			putahex
.9082	20 ec 94	        jsr pushregs
.9085	20 93 90	        jsr atohex
.9088	a2 f4		        ldx #<hexstr+2
.908a	a0 cf		        ldy #>hexstr+2
.908c	20 ca 95	        jsr putsyx
.908f	20 19 95	        jsr popregs
.9092	60		        rts
.9093			atohex
.9093	08		        php
.9094	48		        pha
.9095	48		        pha
.9096	20 ae 90	        jsr lsr4bits
.9099	20 b5 90	        jsr nibtohex
.909c	8d f4 cf	        sta hexstr+2
.909f	68		        pla
.90a0	20 b5 90	        jsr nibtohex
.90a3	8d f5 cf	        sta hexstr+3
.90a6	a9 00		        lda #$00
.90a8	8d f6 cf	        sta hexstr+4
.90ab	68		        pla
.90ac	28		        plp
.90ad	60		        rts
.90ae			lsr4bits
.90ae	08		        php
.90af	4a		        lsr a
.90b0	4a		        lsr a
.90b1	4a		        lsr a
.90b2	4a		        lsr a
.90b3	28		        plp
.90b4	60		        rts
.90b5			nibtohex
.90b5	08		        php
.90b6	29 0f		        and    #$0f
.90b8	f8		        sed
.90b9	18		        clc
.90ba	69 90		        adc #$90
.90bc	69 40		        adc #$40
.90be	28		        plp
.90bf	60		        rts
.90c0			bytestohex
.90c0	20 7a 94	        jsr pushall
.90c3	84 fc		        sty zp1+1
.90c5	86 fb		        stx zp1
.90c7	08		        php
.90c8	48		        pha
.90c9	a9 20		        lda #32
.90cb	20 d2 ff	        jsr chrout
.90ce	68		        pla
.90cf	28		        plp
.90d0	08		        php
.90d1	48		        pha
.90d2	a9 05		        lda #5
.90d4	20 d2 ff	        jsr chrout
.90d7	68		        pla
.90d8	28		        plp
.90d9	08		        php
.90da	48		        pha
.90db	a9 24		        lda #36
.90dd	20 d2 ff	        jsr chrout
.90e0	68		        pla
.90e1	28		        plp
.90e2	20 5e 90	        jsr putyxhex   ; prn adreponsese
.90e5	08		        php
.90e6	48		        pha
.90e7	a9 20		        lda #$20
.90e9	20 d2 ff	        jsr chrout
.90ec	68		        pla
.90ed	28		        plp
.90ee	08		        php
.90ef	48		        pha
.90f0	a9 9f		        lda #159
.90f2	20 d2 ff	        jsr chrout
.90f5	68		        pla
.90f6	28		        plp
.90f7	a0 00		        ldy #$00
.90f9	aa		        tax
.90fa	8c d6 cf	another sty offset
.90fd	b1 fb		        lda (zp1),y
.90ff	20 82 90	        jsr putahex
.9102	48		        pha
.9103	20 22 91	        jsr petsciiaddr
.9106	68		        pla
.9107	8d 00 04	petscii sta $0400
.910a	48		        pha
.910b	a9 0d		        lda #$0d
.910d	8d 00 d8	petcol  sta $d800
.9110	68		        pla
.9111	08		        php
.9112	48		        pha
.9113	a9 20		        lda #$20
.9115	20 d2 ff	        jsr chrout
.9118	68		        pla
.9119	28		        plp
.911a	c8		        iny
.911b	ca		        dex
.911c	d0 dc		        bne another
.911e	20 b3 94	        jsr popall
.9121	60		        rts
.9122			petsciiaddr
.9122	20 ec 94	        jsr pushregs
.9125	08		        php
.9126	a4 d2		        ldy scrnlin+1
.9128	a6 d1		        ldx scrnlin
.912a	28		        plp
.912b	a9 1f		        lda #31
.912d	18		        clc
.912e	6d d6 cf	        adc offset
.9131	20 8a 93	        jsr addatoyx
.9134	8c 09 91	        sty petscii+2
.9137	8e 08 91	        stx petscii+1
.913a	8e 0e 91	        stx petcol+1
.913d	98		        tya
.913e	29 fb		        and #%11111011 ;#%00000100
.9140	09 d8		        ora #$d8
.9142	8d 0f 91	        sta petcol+2
.9145	a8		        tay
.9146	20 19 95	        jsr popregs
.9149	60		        rts
.914a			strhexval
.914a	20 7a 94	        jsr pushall ; sauve registre
.914d	84 fc		        sty zp1+1   ; ptr dans zp1
.914f	86 fb		        stx zp1
.9151	20 78 96	        jsr strlen  ;len de $(yyxx)->a
.9154	f0 3d		        beq oute    ; si 0 erreur C=1
.9156	a0 00		        ldy #$00    ; offset a 0
.9158	8c 9e cf	        sty reponse+1; reponse a zero
.915b	8c 9d cf	        sty reponse ;    ...
.915e	b1 fb		nextc   lda (zp1),y ;charge un caractere
.9160	f0 26		        beq out     ;On  a fini
.9162	c0 00		        cpy #$00    ;si c'est le premier
.9164	f0 07		        beq norol   ; pas de rol
.9166	48		        pha         ;
.9167	a9 04		        lda #$04    ;rol de 4 pos
.9169	20 c4 93	        jsr rolword ;
.916c	68		        pla         ;
.916d	09 20		norol   ora #%00100000
.916f	38		        sec
.9170	e9 30		        sbc #$30
.9172	c9 0a		        cmp #$0a
.9174	90 07		        bcc lt10
.9176	38		        sec
.9177	e9 27		        sbc #$27
.9179	c9 10		        cmp #$10
.917b	b0 16		        bcs oute
.917d	0d 9d cf	lt10    ora reponse
.9180	8d 9d cf	        sta reponse
.9183	c8		        iny
.9184	c0 04		        cpy #$04
.9186	d0 d6		        bne nextc
.9188	20 b3 94	out     jsr popall
.918b	18		        clc          ;Carry 0 = good
.918c	ac 9e cf	        ldy reponse+1
.918f	ae 9d cf	        ldx reponse
.9192	60		        rts
.9193	20 b3 94	oute    jsr popall
.9196	38		        sec
.9197	60		        rts

;******  Return to file: rom9000.asm


;******  Processing file: l-drawbox.asm

.9198			drawbox
.9198	20 7a 94	        jsr pushall
.919b	84 fc		        sty zp1+1
.919d	86 fb		        stx zp1
.919f	a0 00		        ldy #$00
.91a1	b1 fb		        lda (zp1),y
.91a3	20 d6 93	        jsr inczp1
.91a6	8d 98 cf	        sta dbleft  ;Initialise gauche
.91a9	b1 fb		        lda (zp1),y
.91ab	20 d6 93	        jsr inczp1
.91ae	8d 99 cf	        sta dbtop   ;initialise top
.91b1	8d 94 cf	        sta dbclin  ;position de ligne
.91b4	b1 fb		        lda (zp1),y ;
.91b6	20 d6 93	        jsr inczp1
.91b9	8d 97 cf	        sta dbwdth  ;Initialise width.
.91bc	b1 fb		        lda (zp1),y
.91be	20 d6 93	        jsr inczp1
.91c1	8d 96 cf	        sta dbhght  ;Initialise height.
.91c4	ad 86 02	        lda kcol
.91c7	8d f8 cf	        sta curcol
.91ca	b1 fb		        lda (zp1),y ;Initialise couleur.
.91cc	8d 86 02	        sta kcol
.91cf	8d 95 cf	        sta dbcoul
.91d2	20 d6 93	        jsr inczp1
.91d5	20 97 92	        jsr dbdraw  ;Dessine la fenêtre.
.91d8	ae 98 cf	        ldx dbleft
.91db	e8		        inx
.91dc	e8		        inx
.91dd	ac 99 cf	        ldy dbtop
.91e0	20 42 96	        jsr gotoxy
.91e3	20 b4 95	        jsr puts
.91e6	ad f8 cf	        lda curcol
.91e9	8d 86 02	        sta kcol
.91ec	20 b3 94	        jsr popall
.91ef	60		        rts
.91f0			dbtline
.91f0	08		        php         ;Sauve registres.
.91f1	48		        pha
.91f2	a9 b0		        lda #tleft  ;Coin supp gauche.
.91f4	8d 9c cf	        sta cleft
.91f7	a9 c0		        lda #hline  ;Ligne horizontale.
.91f9	8d 9a cf	        sta cmid
.91fc	a9 ae		        lda #tright ;Coin supp droit.
.91fe	8d 9b cf	        sta cright
.9201	28		        plp         ;Récup registres.
.9202	68		        pla
.9203	20 4c 92	        jsr dbdrawline
.9206	60		        rts
.9207			dbbline
.9207	08		        php         ;Sauve registres
.9208	48		        pha
.9209	a9 ad		        lda #bleft  ;Coin inf. gauche.
.920b	8d 9c cf	        sta cleft
.920e	a9 c0		        lda #hline  ;Ligne horizontale.
.9210	8d 9a cf	        sta cmid
.9213	a9 bd		        lda #bright ;Coin inf. droit.
.9215	8d 9b cf	        sta cright
.9218	28		        plp         ;Récup registres
.9219	68		        pla
.921a	20 4c 92	        jsr dbdrawline
.921d	60		        rts
.921e			dbeline
.921e	08		        php         ;Sauve registres
.921f	48		        pha
.9220	a9 dd		        lda #vline  ;Ligne verticale.
.9222	8d 9c cf	        sta cleft
.9225	a9 20		        lda #space  ;Carac espace.
.9227	8d 9a cf	        sta cmid
.922a	a9 dd		        lda #vline  ;Ligne verticale.
.922c	8d 9b cf	        sta cright
.922f	28		        plp         ;Récup registres
.9230	68		        pla
.9231	20 4c 92	        jsr dbdrawline
.9234	60		        rts
.9235			dbhline
.9235	08		        php         ;Sauve registres
.9236	48		        pha
.9237	a9 ab		        lda #hleft  ;Ex. gauche médian
.9239	8d 9c cf	        sta cleft
.923c	a9 c0		        lda #hline  ;Ligne horizontale
.923e	8d 9a cf	        sta cmid
.9241	a9 b3		        lda #hright ;Ex. droite médian
.9243	8d 9b cf	        sta cright
.9246	28		        plp         ;Récup registres
.9247	68		        pla
.9248	20 4c 92	        jsr dbdrawline
.924b	60		        rts
.924c			dbdrawline
.924c	20 ec 94	        jsr pushregs;Sauve registres
.924f	ad 86 02	        lda kcol    ;Sauvegarde de la-
.9252	8d f8 cf	        sta curcol ;-couleur basic.
.9255	ad 95 cf	        lda dbcoul  ;Sélect. couleur-
.9258	8d 86 02	        sta kcol    ;-fenêtre.
.925b	c9 10		        cmp #$10    ;Couleur inverse?
.925d	30 05		        bmi norev   ;Non ...
.925f	a9 12		        lda #18     ;Oui place en inv.
.9261	20 d2 ff	        jsr chrout
.9264	ae 94 cf	norev   ldx dbclin  ;posit curseur au-
.9267	ac 98 cf	        ldy dbleft  ;-coin supp-gauche-
.926a	18		        clc         ;-de la fenêtre.
.926b	20 f0 ff	        jsr plot
.926e	ad 9c cf	        lda cleft   ;dessine 1er car.
.9271	20 d2 ff	        jsr chrout
.9274	ad 9a cf	        lda cmid    ;dessine ligne hor-
.9277	ae 97 cf	        ldx dbwdth  ;-selon largeur-
.927a	ca		        dex         ;-fenêtre moins-
.927b	ca		        dex         ;-2 car extrémité.
.927c	20 6b 96	        jsr putnch
.927f	ad 9b cf	        lda cright  ;dess. dernier car
.9282	20 d2 ff	        jsr chrout
.9285	a9 92		        lda #146    ;fin inverse vidéo
.9287	20 d2 ff	        jsr chrout
.928a	ad f8 cf	        lda curcol ;replace la couleur
.928d	8d 86 02	        sta kcol    ;basic.
.9290	ee 94 cf	        inc dbclin;ligne suivante.
.9293	20 19 95	        jsr popregs ;Récup registres
.9296	60		        rts
.9297			dbdraw
.9297	20 ec 94	        jsr pushregs;Sauve registres
.929a	ae 96 cf	        ldx dbhght  ;recup hautr boite
.929d	20 f0 91	        jsr dbtline ;Dessine ligne sup
.92a0	ca		        dex         ;-2 pour les ...
.92a1	ca		        dex         ;lignes supp/inf
.92a2	f0 06		        beq linfin  ;Si 0 ligne vide.
.92a4	20 1e 92	boucle  jsr dbeline ;Dessine ligne vide
.92a7	ca		        dex         ;
.92a8	d0 fa		        bne boucle  ;prochaine si reste
.92aa	20 07 92	linfin  jsr dbbline ;Dessine ligne inf.
.92ad	20 19 95	        jsr popregs ;Récup registres
.92b0	60		        rts

;******  Return to file: rom9000.asm


;******  Processing file: l-float.asm

.92b1			clrbasbuf
.92b1	08		         php
.92b2	48		         pha
.92b3	98		         tya
.92b4	48		         pha
.92b5	a9 00		         lda #$00
.92b7	a0 59		         ldy #$59
.92b9	99 00 02	again    sta $0200,y
.92bc	88		         dey
.92bd	d0 fa		         bne again
.92bf	68		         pla
.92c0	a8		         tay
.92c1	68		         pla
.92c2	28		         plp
.92c3	60		         rts
.92c4			getfac1
.92c4	20 ec 94	         jsr pushregs
.92c7	20 b1 92	         jsr clrbasbuf
.92ca	20 f9 ab	         jsr prompt
.92cd	86 7a		         stx $7a
.92cf	84 7b		         sty $7b
.92d1	20 73 00	         jsr chrget
.92d4	20 f3 bc	         jsr fasctf1 ;conv. ascii->float
.92d7	20 19 95	         jsr popregs
.92da	60		         rts
.92db			prnfac1
.92db	20 ec 94	         jsr pushregs
.92de	20 dd bd	         jsr ff1tasc
.92e1	20 ca 95	         jsr putsyx
.92e4	20 19 95	         jsr popregs
.92e7	60		         rts
.92e8			prnfac2
.92e8	20 fc bb	         jsr ff2tf1
.92eb	20 db 92	         jsr prnfac1
.92ee	60		         rts

;******  Return to file: rom9000.asm


;******  Processing file: l-keyb.asm

.92ef			clrkbbuf
.92ef	08		            php
.92f0	48		            pha
.92f1	a9 00		            lda #0
.92f3	85 c6		            sta 198
.92f5	68		            pla
.92f6	28		            plp
.92f7	60		            rts
.92f8			waitstop
.92f8	08		          php    ;\ sauve les flags
.92f9	48		          pha    ;/  et l'acc.
.92fa	20 ef 92	          jsr clrkbbuf
.92fd	20 e1 ff	wait      jsr stop ; Veri [run/stop]
.9300	d0 fb		          bne wait ;loop pas pesee.
.9302	68		          pla    ;\ recup. acc et
.9303	28		          plp    ;/  les flags.
.9304	60		          rts
.9305			anykey
.9305	08		        php
.9306	48		        pha
.9307	20 ef 92	        jsr clrkbbuf
.930a	a5 cb		wait    lda 203    ;lit la matrice de
.930c	c9 40		        cmp #64    ; 64 = aucune clef
.930e	f0 fa		        beq wait   ; on en attend une.
.9310	20 19 93	        jsr kbfree ; Clavier relache.
.9313	20 ef 92	        jsr clrkbbuf
.9316	68		        pla
.9317	28		        plp
.9318	60		        rts
.9319			kbfree
.9319	08		        php
.931a	48		        pha
.931b	a5 cb		wait    lda 203    ; lit la matrice
.931d	c9 40		        cmp #64    ; 64 = aucune clef
.931f	d0 fa		        bne wait   ; attend la relache
.9321	68		        pla
.9322	28		        plp
.9323	60		        rts
.9324			getkey
.9324	08		        php
.9325	20 e4 ff	try     jsr getin  ;tente de lire
.9328	c9 00		        cmp #0     ; 0 si aucune.
.932a	f0 f9		        beq try    ; on reessaye
.932c	28		        plp
.932d	60		        rts
.932e			waitkey
.932e	08		        php
.932f	48		        pha
.9330	8d 91 cf	        sta clef   ;Sauve clef voulue
.9333	20 ef 92	        jsr clrkbbuf
.9336	20 e4 ff	wait    jsr getin  ;Sonde le clavier
.9339	cd 91 cf	        cmp clef   ;Compare avec clef
.933c	d0 f8		        bne wait   ;Pas la bonne.
.933e	68		        pla
.933f	28		        plp
.9340	60		        rts
.9341			waitspace
.9341	a9 20		            lda #$20
.9343	20 2e 93	            jsr waitkey
.9346	20 ef 92	            jsr clrkbbuf
.9349	60		            rts
.934a			showkey
.934a	20 ec 94	        jsr pushregs
.934d	38		        sec
.934e	20 f0 ff	        jsr plot
.9351	8e 93 cf	        stx curx
.9354	8c 92 cf	        sty cury
.9357	20 ec 94	        jsr pushregs
.935a	a2 1c		        ldx #39-11
.935c	a0 18		        ldy #24
.935e	20 42 96	        jsr gotoxy
.9361	20 19 95	        jsr popregs
.9364	20 d2 ff	        jsr chrout
.9367	08		        php
.9368	48		        pha
.9369	a9 20		        lda #32
.936b	20 d2 ff	        jsr chrout
.936e	68		        pla
.936f	28		        plp
.9370	08		        php
.9371	48		        pha
.9372	a9 24		        lda #36
.9374	20 d2 ff	        jsr chrout
.9377	68		        pla
.9378	28		        plp
.9379	20 96 96	        jsr putahexdec
.937c	18		        clc
.937d	ac 92 cf	        ldy cury
.9380	ae 93 cf	        ldx curx
.9383	20 f0 ff	        jsr plot
.9386	20 19 95	        jsr popregs
.9389	60		        rts

;******  Return to file: rom9000.asm


;******  Processing file: l-math.asm

.938a			addatoyx
.938a	08		        php
.938b	48		        pha
.938c	8c 9e cf	        sty reponse+1
.938f	8e 9d cf	        stx reponse
.9392	18		        clc
.9393	6d 9d cf	        adc reponse
.9396	90 03		        bcc norep
.9398	ee 9e cf	        inc reponse+1
.939b	8d 9d cf	norep   sta reponse
.939e	ac 9e cf	        ldy reponse+1
.93a1	ae 9d cf	        ldx reponse
.93a4	68		        pla
.93a5	28		        plp
.93a6	60		        rts
.93a7			subatoyx
.93a7	08		        php
.93a8	48		        pha
.93a9	8c 9e cf	        sty reponse+1
.93ac	8e 9d cf	        stx reponse
.93af	38		        sec
.93b0	ed 9d cf	        sbc reponse
.93b3	b0 03		        bcs noemp
.93b5	ce 9e cf	        dec reponse+1
.93b8	8d 9d cf	noemp   sta reponse
.93bb	ac 9e cf	        ldy reponse+1
.93be	ae 9d cf	        ldx reponse
.93c1	68		        pla
.93c2	28		        plp
.93c3	60		        rts
.93c4			rolword
.93c4	20 ec 94	        jsr pushregs
.93c7	a8		        tay
.93c8	18		again   clc
.93c9	2e 9d cf	        rol reponse
.93cc	2e 9e cf	        rol reponse+1
.93cf	88		        dey
.93d0	d0 f6		        bne again
.93d2	20 19 95	        jsr popregs
.93d5	60		        rts

;******  Return to file: rom9000.asm


;******  Processing file: l-mem.asm

.93d6			inczp1
.93d6	08		         php
.93d7	e6 fb		         inc zp1
.93d9	d0 02		         bne repzp1
.93db	e6 fc		         inc zp1+1
.93dd	28		repzp1   plp
.93de	60		         rts
.93df			inczp2
.93df	08		         php
.93e0	e6 fd		         inc zp2
.93e2	d0 02		         bne repzp2
.93e4	e6 fe		         inc zp2+1
.93e6	28		repzp2   plp
.93e7	60		         rts
.93e8			deczp1
.93e8	08		         php
.93e9	48		         pha
.93ea	a5 fb		         lda zp1
.93ec	d0 02		         bne noemp
.93ee	c6 fc		         dec zp1+1
.93f0	c6 fb		noemp    dec zp1
.93f2	68		         pla
.93f3	28		         plp
.93f4	60		         rts
.93f5			deczp2
.93f5	08		         php
.93f6	48		         pha
.93f7	a5 fd		         lda zp2
.93f9	d0 02		         bne noemp
.93fb	c6 fe		         dec zp2+1
.93fd	c6 fd		noemp    dec zp2
.93ff	68		         pla
.9400	28		         plp
.9401	60		         rts
.9402			rolzp1
.9402	08		        php
.9403	48		        pha
.9404	18		        clc
.9405	a5 fb		        lda zp1
.9407	2a		        rol
.9408	85 fb		        sta zp1
.940a	a5 fc		        lda zp1+1
.940c	2a		        rol
.940d	85 fc		        sta zp1+1
.940f	68		        pla
.9410	28		        plp
.9411			rorzp1
.9411	08		        php
.9412	48		        pha
.9413	18		        clc
.9414	a5 fc		        lda zp1+1
.9416	6a		        ror
.9417	85 fc		        sta zp1+1
.9419	a5 fb		        lda zp1
.941b	6a		        ror
.941c	85 fb		        sta zp1
.941e	68		        pla
.941f	28		        plp
.9420			rolzp2
.9420	08		        php
.9421	48		        pha
.9422	18		        clc
.9423	a5 fd		        lda zp2
.9425	2a		        rol
.9426	85 fd		        sta zp2
.9428	a5 fe		        lda zp2+1
.942a	2a		        rol
.942b	85 fe		        sta zp2+1
.942d	68		        pla
.942e	28		        plp
.942f			rorzp2
.942f	08		        php
.9430	48		        pha
.9431	18		        clc
.9432	a5 fe		        lda zp2+1
.9434	6a		        ror
.9435	85 fe		        sta zp2+1
.9437	a5 fd		        lda zp2
.9439	6a		        ror
.943a	85 fd		        sta zp2
.943c	68		        pla
.943d	28		        plp
.943e			yxtoptr
.943e	8c f8 cf	        sty memptr+1
.9441	8e f7 cf	        stx memptr
.9444	60		        rts
.9445			ptrtoyx
.9445	08		        php
.9446	ac f8 cf	        ldy memptr+1
.9449	ae f7 cf	        ldx memptr
.944c	28		        plp
.944d	60		        rts
.944e			incptr
.944e	08		        php
.944f	ee f7 cf	        inc memptr
.9452	d0 03		        bne norep
.9454	ee f8 cf	        inc memptr+1
.9457	28		norep   plp
.9458	60		        rts
.9459			decptr
.9459	08		        php
.945a	48		        pha
.945b	ad f7 cf	        lda memptr
.945e	d0 03		        bne noemp
.9460	ee f8 cf	        inc memptr+1
.9463	ee f7 cf	noemp   inc memptr
.9466	68		        pla
.9467	28		        plp
.9468	60		        rts
.9469			incptr8
.9469	08		        php
.946a	48		        pha
.946b	98		        tya
.946c	48		        pha
.946d	a0 08		        ldy #8
.946f	20 4e 94	again   jsr incptr
.9472	88		        dey
.9473	d0 fa		        bne again
.9475	68		        pla
.9476	a8		        tay
.9477	68		        pla
.9478	28		        plp
.9479	60		        rts

;******  Return to file: rom9000.asm


;******  Processing file: l-push.asm

.947a			pushall
.947a	08		         php     ;s;rp,pcl,pch
.947b	8d fe cf	         sta ra  ;sauve a
.947e	68		         pla     ;s:pcl,pch
.947f	8d ff cf	         sta rp  ;sauve rp
.9482	68		         pla     ;s:pch
.9483	8d f9 cf	         sta pc  ;sauve pcl
.9486	68		         pla     ;s:
.9487	8d fa cf	         sta pc+1;sauve pch
.948a	a5 fb		         lda $fb ;sauve fb
.948c	48		         pha     ;s:fb
.948d	a5 fc		         lda $fc ;sauve fc
.948f	48		         pha     ;s:fc,fb
.9490	a5 fd		         lda $fd ;sauve fd
.9492	48		         pha     ;s:fd,fc,fb
.9493	a5 fe		         lda $fe ;sauve fe
.9495	48		         pha     ;s:fe,fd,fc,fb
.9496	ad ff cf	         lda rp  ;sauve rp
.9499	48		         pha     ;s:rp,fe,fd,fc,fb
.949a	ad fe cf	         lda ra  ;sauve ra
.949d	48		         pha     ;s:ra,rp,fe,fd,fc,fb
.949e	8a		         txa     ;sauve rx
.949f	48		         pha     ;s:rx,ra,rp,fe-fb
.94a0	98		         tya     ;sauve y
.94a1	48		         pha     ;s:ry,rx,ra,rp,fe-fb
.94a2	ad fa cf	         lda pc+1;replace l'adresse
.94a5	48		         pha     ;s:pch,ry,rx,ra,...
.94a6	ad f9 cf	         lda pc  ; de retour.
.94a9	48		         pha     ;s:pcl,pch,ru,rx,ra,...
.94aa	ad ff cf	         lda rp  ;place les flags
.94ad	48		         pha     ; sur le stack.
.94ae	ad fe cf	         lda ra  ;recupere ra
.94b1	28		         plp     ;recupere les flags.
.94b2	60		         rts
.94b3			popall
.94b3	08		         php     ;s:rp,pcl,pch,ry,rx,...
.94b4	8d fe cf	         sta ra
.94b7	68		         pla     ;s:pcl,pch,ry,rx,...
.94b8	8d ff cf	         sta rp  ;s:pch,ry,rx,ra,rp,...
.94bb	68		         pla
.94bc	8d f9 cf	         sta pc  ;sauve pcl
.94bf	68		         pla     ;s:ry,rx,ra,rp,fe...fb
.94c0	8d fa cf	         sta pc+1;sauve pch
.94c3	68		         pla     ;s:rx,ra,rp,fe,fd,fc,fb
.94c4	a8		         tay     ;recupere ry
.94c5	68		         pla     ;s:ra,rp,fe,fd,fc,fb
.94c6	aa		         tax     ;recupere rx
.94c7	68		         pla     ;s:rp,fe,fd,fc,fb
.94c8	8d fe cf	         sta ra  ;recupere ra
.94cb	68		         pla     ;s:fe,fd,fc,fb
.94cc	8d ff cf	         sta rp  ;recupere les flags.
.94cf	68		         pla     ;s:fd,fc,fb
.94d0	85 fe		         sta $fe ;reccupere fe
.94d2	68		         pla     ;s:fc,fb
.94d3	85 fd		         sta $fd ;recupere fd
.94d5	68		         pla     ;s:fb
.94d6	85 fc		         sta $fc ;recupere fc
.94d8	68		         pla     ;s:
.94d9	85 fb		         sta $fb ;recupere fb
.94db	ad fa cf	         lda pc+1;replaace l'adresse de
.94de	48		         pha     ;s:pch
.94df	ad f9 cf	         lda pc  ;retour sur la pile
.94e2	48		         pha     ;s:pcl,pch
.94e3	ad ff cf	         lda rp  ;recupere les flags
.94e6	48		         pha     ;s:rp,pcl,pch
.94e7	ad fe cf	         lda ra  ;recupere ra
.94ea	28		         plp     ;s:pcl,pch
.94eb	60		         rts
.94ec			pushregs
.94ec	08		         php     ;s;rp,pcl,pch
.94ed	8d fe cf	         sta ra  ; -- sauve a
.94f0	68		         pla     ;s:pcl,pch
.94f1	8d ff cf	         sta rp  ; -- sauve rp
.94f4	68		         pla     ;s:pch
.94f5	8d f9 cf	         sta pc  ; -- sauve pcl
.94f8	68		         pla     ;s:
.94f9	8d fa cf	         sta pc+1; -- sauve pch
.94fc	ad ff cf	         lda rp  ; -- sauve rp
.94ff	48		         pha     ;s:rp
.9500	ad fe cf	         lda ra  ; -- sauve ra
.9503	48		         pha     ;s:ra,rp
.9504	8a		         txa     ; -- tfr rx
.9505	48		         pha     ;s:rx,ra,rp
.9506	98		         tya     ; -- tfr ry
.9507	48		         pha     ;s:ry,rx,ra,rp
.9508	ad fa cf	         lda pc+1; -- replace l'adresse
.950b	48		         pha     ;s:pch,ry,rx,ra,rp
.950c	ad f9 cf	         lda pc  ; -- de retour.
.950f	48		         pha     ;s:pcl,pch,ru,rx,ra,rp
.9510	ad ff cf	         lda rp  ; -- place les flags
.9513	48		         pha     ;    sur le stack.
.9514	ad fe cf	         lda ra  ; -- recupere ra
.9517	28		         plp     ; -- recupere flags.
.9518	60		         rts     ;s:pcl,pch,ru,rx,ra,rp
.9519			popregs
.9519	08		         php
.951a	8d fe cf	         sta ra
.951d	68		         pla
.951e	8d ff cf	         sta rp
.9521	68		         pla     ;s:pch,ry,rx,ra,rp
.9522	8d f9 cf	         sta pc  ; -- sauve pcl
.9525	68		         pla     ;s:ry,rx,ra,rp
.9526	8d fa cf	         sta pc+1; -- sauve pch
.9529	68		         pla     ;s:rx,ra,rp
.952a	a8		         tay     ;recupere ry
.952b	68		         pla     ;s:ra,rp
.952c	aa		         tax     ;recupere rx
.952d	68		         pla     ;s:rp
.952e	8d fe cf	         sta ra  ;recupere ra
.9531	68		         pla     ;s:
.9532	8d ff cf	         sta rp  ;recupere les flags.
.9535	ad fa cf	         lda pc+1;replace l'adresse de
.9538	48		         pha     ;s:pch
.9539	ad f9 cf	         lda pc  ;retour sur la pile
.953c	48		         pha     ;s:pcl,pch
.953d	ad ff cf	         lda rp  ;recupere les flags
.9540	48		         pha     ;s:rp,pcl,pch
.9541	ad fe cf	         lda ra  ;recupere ra
.9544	28		         plp     ;s:pcl,pch
.9545	60		         rts

;******  Return to file: rom9000.asm


;******  Processing file: l-screen.asm

.9546			scrnsave
.9546	20 7a 94	        jsr pushall
.9549	20 92 95	        jsr setcarptr
.954c	20 6c 95	        jsr zp1tozp2
.954f	20 a3 95	        jsr setcolptr
.9552	20 6c 95	        jsr zp1tozp2
.9555	20 b3 94	        jsr popall
.9558	60		        rts
.9559			scrnrest
.9559	20 7a 94	        jsr pushall
.955c	20 92 95	        jsr setcarptr
.955f	20 7f 95	        jsr zp2tozp1
.9562	20 a3 95	        jsr setcolptr
.9565	20 7f 95	        jsr zp2tozp1
.9568	20 b3 94	        jsr popall
.956b	60		        rts
.956c			zp1tozp2
.956c	a2 04		        ldx #$04
.956e	a0 00		        ldy #$00
.9570	b1 fb		nextcar lda (zp1),y
.9572	91 fd		        sta (zp2),y
.9574	c8		        iny
.9575	d0 f9		        bne nextcar
.9577	e6 fc		        inc zp1+1
.9579	e6 fe		        inc zp2+1
.957b	ca		        dex
.957c	d0 f2		        bne nextcar
.957e	60		        rts
.957f			zp2tozp1
.957f	a2 04		        ldx #$04
.9581	a0 00		        ldy #$00
.9583	b1 fd		nextcar lda (zp2),y
.9585	91 fb		        sta (zp1),y
.9587	c8		        iny
.9588	d0 f9		        bne nextcar
.958a	e6 fc		        inc zp1+1
.958c	e6 fe		        inc zp2+1
.958e	ca		        dex
.958f	d0 f2		        bne nextcar
.9591	60		        rts
.9592			setcarptr
.9592	a9 00		        lda #$00
.9594	85 fb		        sta zp1
.9596	a9 04		        lda #$04
.9598	85 fc		        sta zp1+1
.959a	a9 8d		        lda #<scrncar
.959c	85 fd		        sta zp2
.959e	a9 cb		        lda #>scrncar
.95a0	85 fe		        sta zp2+1
.95a2	60		        rts
.95a3			setcolptr
.95a3	a9 00		        lda #$00
.95a5	85 fb		        sta zp1
.95a7	a9 d8		        lda #$d8
.95a9	85 fc		        sta zp1+1
.95ab	a9 8d		        lda #<scrncol
.95ad	85 fd		        sta zp2
.95af	a9 c7		        lda #>scrncol
.95b1	85 fe		        sta zp2+1
.95b3	60		        rts

;******  Return to file: rom9000.asm


;******  Processing file: l-string.asm

.95b4			puts
.95b4	20 7a 94	        jsr pushall
.95b7	a0 00		        ldy #$00   ; y = offset
.95b9	b1 fb		nextc   lda ($fb),y;lit un caractere
.95bb	f0 09		        beq out    ;si 0 on sort
.95bd	20 d2 ff	        jsr chrout ;on l'affiche
.95c0	20 d6 93	        jsr inczp1 ;pointe le prochain
.95c3	4c b9 95	        jmp nextc  ; et l'affiche
.95c6	20 b3 94	out     jsr popall
.95c9	60		        rts
.95ca			putsyx
.95ca	20 7a 94	        jsr pushall;sauve reg + zps
.95cd	86 fb		        stx $fb    ;$yyxx dans
.95cf	84 fc		        sty $fb+1  ; zp1
.95d1	20 b4 95	        jsr puts
.95d4	20 b3 94	        jsr popall ;recup reg + zps
.95d7	60		        rts
.95d8			putsxy
.95d8	20 7a 94	        jsr pushall;sauve reg + zps
.95db	86 fb		        stx $fb    ;$yyxx dans
.95dd	84 fc		        sty $fb+1  ; zp1
.95df	a0 00		        ldy #$00
.95e1	b1 fb		        lda ($fb),y
.95e3	aa		        tax
.95e4	20 d6 93	        jsr inczp1
.95e7	b1 fb		        lda ($fb),y
.95e9	20 d6 93	        jsr inczp1
.95ec	a8		        tay
.95ed	20 42 96	        jsr gotoxy
.95f0	20 b4 95	        jsr puts
.95f3	20 b3 94	        jsr popall ;recup reg + zps
.95f6	60		        rts
.95f7			putsc
.95f7	08		        php        ;flag sur stack
.95f8	48		        pha        ;acc sur stack
.95f9	48		        pha        ;sauvegarde acc
.95fa	ad 86 02	        lda kcol   ;recup coul. carac.
.95fd	8d f8 cf	        sta curcol ; et la sauvegarde
.9600	68		        pla        ;recup. acc
.9601	8d 86 02	        sta kcol   ;place coul. voulue
.9604	20 b4 95	        jsr puts   ;affiche la chaine
.9607	ad f8 cf	        lda curcol ;recup coul. carac.
.960a	8d 86 02	        sta kcol   ; et la replace
.960d	68		        pla        ;recup acc
.960e	28		        plp        ;recup flag
.960f	60		        rts
.9610			putscyx
.9610	08		        php       ;sauve registres
.9611	48		        pha       ; ...
.9612	48		        pha       ;sauve acc
.9613	ad 86 02	        lda kcol  ;recup couleur carac.
.9616	8d f8 cf	        sta curcol; et sauvegarde
.9619	68		        pla       ;recup acc
.961a	8d 86 02	        sta kcol  ;place couleur carac.
.961d	20 ca 95	        jsr putsyx;affiche la chaine
.9620	ad f8 cf	        lda curcol
.9623	8d 86 02	        sta kcol
.9626	68		        pla
.9627	28		        plp
.9628	60		        rts
.9629			putscxy
.9629	08		        php       ;sauve registres
.962a	48		        pha       ; ...
.962b	48		        pha       ;sauve acc
.962c	ad 86 02	        lda kcol  ;recup couleur carac.
.962f	8d f8 cf	        sta curcol; et sauvegarde
.9632	68		        pla       ;recup acc
.9633	8d 86 02	        sta kcol  ;place couleur carac.
.9636	20 d8 95	        jsr putsxy;affiche la chaine
.9639	ad f8 cf	        lda curcol
.963c	8d 86 02	        sta kcol
.963f	68		        pla
.9640	28		        plp
.9641	60		        rts
.9642			gotoxy
.9642	20 ec 94	        jsr pushregs
.9645	8a		        txa ; interchange x et y
.9646	48		        pha ; ...
.9647	98		        tya ; ...
.9648	aa		        tax ; ...
.9649	68		        pla ; ...
.964a	a8		        tay ; ...
.964b	c0 00		txlow   cpy #0
.964d	10 02		        bpl txhigh
.964f	a2 00		        ldx #0
.9651	e0 19		txhigh  cpx #25
.9653	30 02		        bmi tylow
.9655	a2 18		        ldx #24
.9657	c0 00		tylow   cpy #0
.9659	10 02		        bpl tyhigh
.965b	a0 00		        ldy #0
.965d	c0 28		tyhigh  cpy #40
.965f	30 02		        bmi allok
.9661	a0 27		        ldy #39
.9663	18		allok   clc
.9664	20 f0 ff	        jsr plot
.9667	20 19 95	        jsr popregs
.966a	60		        rts
.966b			putnch
.966b	20 ec 94	        jsr pushregs
.966e	20 d2 ff	again   jsr chrout
.9671	ca		        dex
.9672	d0 fa		        bne again
.9674	20 19 95	        jsr popregs
.9677	60		        rts
.9678			strlen
.9678	20 7a 94	        jsr pushall
.967b	84 fc		        sty zp1+1
.967d	86 fb		        stx zp1
.967f	a0 00		        ldy #$00
.9681	8c 90 cf	        sty len
.9684	b1 fb		next    lda (zp1),y
.9686	f0 07		        beq out
.9688	ee 90 cf	        inc len
.968b	c8		        iny
.968c	4c 84 96	        jmp next
.968f	20 b3 94	out     jsr popall
.9692	ad 90 cf	        lda len
.9695	60		        rts
.9696			putahexdec
.9696	20 ec 94	        jsr pushregs
.9699	08		        php
.969a	48		        pha
.969b	a9 9e		        lda #kjaune
.969d	20 d2 ff	        jsr chrout
.96a0	68		        pla
.96a1	28		        plp
.96a2	20 82 90	        jsr putahex
.96a5	08		        php
.96a6	48		        pha
.96a7	a9 20		        lda #$20
.96a9	20 d2 ff	        jsr chrout
.96ac	68		        pla
.96ad	28		        plp
.96ae	08		        php
.96af	48		        pha
.96b0	a9 9f		        lda #kcyan
.96b2	20 d2 ff	        jsr chrout
.96b5	68		        pla
.96b6	28		        plp
.96b7	aa		        tax
.96b8	a9 00		        lda #$00
.96ba	20 cd bd	        jsr fiaxtf1
.96bd	20 19 95	        jsr popregs
.96c0	60		        rts

;******  Return to file: rom9000.asm


;******  Processing file: l-disk.asm

.96c1			diskerror
.96c1	08		        php
.96c2	48		        pha
.96c3	8a		        txa
.96c4	48		        pha
.96c5	98		        tya
.96c6	48		        pha
.96c7	ad 88 c7	     lda  ddev ;Device 8
.96ca	85 ba		     sta  $ba  ;
.96cc	20 b4 ff	     jsr  $ffb4;talk
.96cf	a9 6f		     lda  #$6f
.96d1	85 b9		     sta  $b9
.96d3	20 96 ff	     jsr  $ff96;tksa
.96d6	20 a5 ff	next jsr  $ffa5;acptr
.96d9	20 d2 ff	     jsr  $ffd2;chrout
.96dc	c9 0d		     cmp  #$0d ;Est-ce un CR ?
.96de	d0 f6		     bne  next ;Non, au prochain
.96e0	20 ab ff	     jsr  $ffab;untlk
.96e3	68		        pla
.96e4	a8		        tay
.96e5	68		        pla
.96e6	aa		        tax
.96e7	68		        pla
.96e8	28		        plp
.96e9	60		     rts
.96ea			diskdir
.96ea	08		        php
.96eb	48		        pha
.96ec	8a		        txa
.96ed	48		        pha
.96ee	98		        tya
.96ef	48		        pha
.96f0	a9 24		     lda  #$24 ;nfichier = "$"
.96f2	85 fb		     sta  $fb  ;zp1 msb
.96f4	a9 fb		     lda  #$fb ;Set nom-fichier actuel
.96f6	85 bb		     sta  $bb  ;mab nfichier actuel.
.96f8	a9 00		     lda  #$00 ;vers zp1
.96fa	85 bc		     sta  $bc  ;lsb nfichier actuel.
.96fc	a9 01		     lda  #$01 ;Indique -
.96fe	85 b7		     sta  $b7  ;- longueur de nfichier
.9700	ad 88 c7	     lda  ddev ;Indique 8 as comme -
.9703	85 ba		     sta  $ba  ;- periph serie actuel
.9705	a9 60		     lda  #$60 ;Peuple $60 a l'adresse-
.9707	85 b9		     sta  $b9  ;- secondaire.
.9709	20 d5 f3	     jsr  $f3d5;sfopen ouvert. fichier
.970c	a5 ba		     lda  $ba  ;Cmd dev $ba %10111010
.970e	20 b4 ff	     jsr  $ffb4;talk.
.9711	a5 b9		     lda  $b9  ;Cmd sec. adr. ($60) ...
.9713	20 96 ff	     jsr  $ff96;tksa ... to talk.
.9716	a9 00		     lda  #$00 ;Met $00 dans ...
.9718	85 90		     sta  $90  ;... kernal status word.
.971a	a0 03		     ldy  #$03 ;pour lire 3 Byt, -
.971c			loop1
.971c	84 fb		     sty  $fb  ;-mettre $3 dans zp1 Msb
.971e	20 a5 ff	     jsr  $ffa5;acptr Recoit un byte.
.9721	85 fc		     sta  $fc  ;Met octet dans zp1 lsb
.9723	a4 90		     ldy  $90  ;Lit kernal status word.
.9725	d0 2f		     bne  exit ;Si erreur, EXIT.
.9727	20 a5 ff	     jsr  $ffa5;acptr
.972a	a4 90		     ldy  $90  ;Lit compteur d'octet.
.972c	d0 28		     bne  exit
.972e	a4 fb		     ldy  $fb
.9730	88		     dey
.9731	d0 e9		     bne  loop1;si pas dernier, loop
.9733	a6 fc		     ldx  $fc  ;Chrg Octet recu dans x.
.9735	20 cd bd	     jsr  $bdcd;bputint print file size
.9738	a9 20		     lda  #$20 ;Chrg Espace et ...
.973a	20 d2 ff	     jsr  $ffd2;chrout ... l'affiche.
.973d			loop3
.973d	20 a5 ff	     jsr  $ffa5;acptr Recoit un byte.
.9740	a6 90		     ldx  $90  ;Chrg kernal status word
.9742	d0 12		     bne  exit ;Si erreur, EXIT.
.9744	aa		     tax       ;tfr a dans x
.9745	f0 06		     beq  loop2;Byte est =0 loop1
.9747	20 d2 ff	     jsr  $ffd2;chrout,  >0 l'affiche.
.974a	4c 3d 97	     jmp  loop3;Chrg un autre octets
.974d			loop2
.974d	a9 0d		     lda  #$0d ;Chrg CR dans a ...
.974f	20 d2 ff	     jsr  $ffd2;chrout ... l'affiche.
.9752	a0 02		     ldy  #$02 ;Met 2 dans y.
.9754	d0 c6		     bne  loop1;-a la prochaine entree.
.9756			exit
.9756	20 42 f6	     jsr  $f642;sfclose ... close file.
.9759	68		        pla
.975a	a8		        tay
.975b	68		        pla
.975c	aa		        tax
.975d	68		        pla
.975e	28		        plp
.975f	60		     rts
.9760			directory
.9760	20 ea 96	     jsr  diskdir
.9763	20 c1 96	     jsr  diskerror
.9766	60		     rts
.9767			memtofile
.9767	20 28 98	     jsr  dputsavemesg
.976a	08		        php
.976b	48		        pha
.976c	8a		        txa
.976d	48		        pha
.976e	98		        tya
.976f	48		        pha
.9770	ad 84 c7	     lda  dfnlen
.9773	ae 85 c7	     ldx  dfnptr    ;Chrg fn addr. lsb
.9776	ac 86 c7	     ldy  dfnptr+1  ;Chrg fn addr. msb
.9779	20 bd ff	     jsr  $ffbd     ;setnam
.977c	ad 87 c7	     lda  dlfsno
.977f	ae 88 c7	     ldx  ddev      ;Periph. specifie
.9782			skip
.9782	a0 00		     ldy  #$00
.9784	20 ba ff	     jsr  $ffba     ;setlfs
.9787	ad 8b c7	     lda  ddatas    ;ddatas lsb->stal
.978a	85 c1		     sta  stal
.978c	ad 8c c7	     lda  ddatas+1  ;ddatas msb->stal+1
.978f	85 c2		     sta  stal+1
.9791	ae 89 c7	     ldx  ddatae    ;Met ddatae lsb->x
.9794	ac 8a c7	     ldy  ddatae+1  ;Met ddatae msb->y
.9797	a9 c1		     lda  #stal     ;Adr debut->$c1/$c2
.9799	20 d8 ff	     jsr  $ffd8     ;save
.979c	90 00		     bcc  noerror   ;Si C=1, erreur
.979e			noerror
.979e	68		        pla
.979f	a8		        tay
.97a0	68		        pla
.97a1	aa		        tax
.97a2	68		        pla
.97a3	28		        plp
.97a4	60		     rts
.97a5			filetomem
.97a5	08		        php
.97a6	48		        pha
.97a7	8a		        txa
.97a8	48		        pha
.97a9	98		        tya
.97aa	48		        pha
.97ab	20 35 98	     jsr dputsloadmesg
.97ae	ad 84 c7	     lda dfnlen  ;Chrg nfichier len.
.97b1	ae 85 c7	     ldx dfnptr  ;Pointe $yyxx sur ptr-
.97b4	ac 86 c7	     ldy dfnptr+1;- nfichier
.97b7	20 bd ff	     jsr $ffbd   ;setnam
.97ba	ad 87 c7	     lda dlfsno  ;Chrg lfn dans a
.97bd	ae 88 c7	     ldx ddev    ;Periph #8
.97c0	a0 01		     ldy #$01    ;$00:adresse<-yyxx
.97c2	20 ba ff	     jsr $ffba   ;setlfs
.97c5	a9 00		     lda #$00    ;$00:Chrg en memoire
.97c7	20 d5 ff	     jsr $ffd5   ;load
.97ca	90 03		     bcc noerror ;C=1, Erreur
.97cc	20 d6 97	     jsr dskerror
.97cf			noerror
.97cf	68		        pla
.97d0	a8		        tay
.97d1	68		        pla
.97d2	aa		        tax
.97d3	68		        pla
.97d4	28		        plp
.97d5	60		     rts
.97d6			dskerror
.97d6	08		        php
.97d7	48		        pha
.97d8	8a		        txa
.97d9	48		        pha
.97da	98		        tya
.97db	48		        pha
.97dc			isit01
.97dc	c9 01		     cmp  #$01
.97de	d0 07		     bne  isit02
.97e0	a2 8b		     ldx  #<dmsge1
.97e2	a0 98		     ldy  #>dmsge1
.97e4	4c 1e 98	     jmp  printerror
.97e7			isit02
.97e7	c9 02		     cmp  #$02
.97e9	d0 07		     bne  isit05
.97eb	a2 a0		     ldx  #<dmsge2
.97ed	a0 98		     ldy  #>dmsge2
.97ef	4c 1e 98	     jmp  printerror
.97f2			isit05
.97f2	c9 05		     cmp  #$05
.97f4	d0 07		     bne  isit04
.97f6	a2 b4		     ldx  #<dmsge5
.97f8	a0 98		     ldy  #>dmsge5
.97fa	4c 1e 98	     jmp  printerror
.97fd			isit04
.97fd	c9 04		     cmp  #$04
.97ff	d0 07		     bne  isit1d
.9801	a2 c5		     ldx  #<dmsge4
.9803	a0 98		     ldy  #>dmsge4
.9805	4c 1e 98	     jmp  printerror
.9808			isit1d
.9808	c9 1d		     cmp  #$1d
.980a	d0 07		     bne  isit00
.980c	a2 db		     ldx  #<dmsge1d
.980e	a0 98		     ldy  #>dmsge1d
.9810	4c 1e 98	     jmp  printerror
.9813			isit00
.9813	c9 00		     cmp  #$00
.9815	d0 0a		     bne  noerror
.9817	a2 f2		     ldx  #<dmsge0
.9819	a0 98		     ldy  #>dmsge0
.981b	4c 1e 98	     jmp  printerror
.981e			printerror
.981e	20 ca 95	     jsr  putsyx
.9821			noerror
.9821	68		        pla
.9822	a8		        tay
.9823	68		        pla
.9824	aa		        tax
.9825	68		        pla
.9826	28		        plp
.9827	60		     rts
.9828			dputsavemesg
.9828	08		        php
.9829	48		        pha
.982a	8a		        txa
.982b	48		        pha
.982c	98		        tya
.982d	48		        pha
.982e	a2 60		     ldx  #<dmsg0
.9830	a0 98		     ldy  #>dmsg0
.9832	4c 42 98	     jmp  putmsg
.9835			dputsloadmesg
.9835	08		        php
.9836	48		        pha
.9837	8a		        txa
.9838	48		        pha
.9839	98		        tya
.983a	48		        pha
.983b	a2 71		     ldx  #<dmsgc
.983d	a0 98		     ldy  #>dmsgc
.983f	4c 42 98	     jmp  putmsg
.9842			putmsg
.9842	20 ca 95	     jsr  putsyx
.9845	ae 85 c7	     ldx  dfnptr
.9848	ac 86 c7	     ldy  dfnptr+1
.984b	20 ca 95	     jsr  putsyx
.984e	a9 21		     lda  #33
.9850	20 d2 ff	     jsr  $ffd2
.9853	ad 87 c7	     lda  dlfsno
.9856	20 c3 ff	     jsr  close
.9859	68		        pla
.985a	a8		        tay
.985b	68		        pla
.985c	aa		        tax
.985d	68		        pla
.985e	28		        plp
.985f	60		     rts
>9860	0d 8d		dmsg0   .byte $0d,141
>9862	53 41 55 56	     .null "sauvegarde de "
>9866	45 47 41 52 44 45 20 44 45 20 00
>9871	0d 8d		dmsgc   .byte $0d,141
>9873	43 48 41 52	     .null "chargement de "
>9877	47 45 4d 45 4e 54 20 44 45 20 00
>9882	0d 8d		dmsg1   .byte $0d,141
>9884	52 45 55 53	     .null "reussi"
>9888	53 49 00
>988b	0d 8d		dmsge1  .byte $0d,141
>988d	46 49 43 48	     .null "fichier non ouvert"
>9891	49 45 52 20 4e 4f 4e 20 4f 55 56 45 52 54 00
>98a0	0d 11		dmsge2  .byte $0d,17
>98a2	45 52 52 45	     .null "erreur d'ecriture"
>98a6	55 52 20 44 27 45 43 52 49 54 55 52 45 00
>98b4	0d 11		dmsge5  .byte $0d,17
>98b6	4c 45 43 54	     .null "lecteur absent"
>98ba	45 55 52 20 41 42 53 45 4e 54 00
>98c5	0d 11		dmsge4  .byte $0d,17
>98c7	46 49 43 48	     .null "fichier introuvable"
>98cb	49 45 52 20 49 4e 54 52 4f 55 56 41 42 4c 45 00
>98db	0d 11		dmsge1d .byte $0d,17
>98dd	45 52 52 45	     .null "erreur de chargement"
>98e1	55 52 20 44 45 20 43 48 41 52 47 45 4d 45 4e 54
>98f1	00
>98f2	0d 11		dmsge0  .byte $0d,17
>98f4	42 52 45 41	     .null "break error"
>98f8	4b 20 45 52 52 4f 52 00

;******  Return to file: rom9000.asm


;******  Processing file: m-utils.asm


;******  Return to file: rom9000.asm


;******  End of listing
